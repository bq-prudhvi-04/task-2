name: Docker Image CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Build
      id: build
      run: |
         echo "Failing: 2" > results.txt
         echo "::set-output name=build::$(cat results.txt)"
         docker build . >> test.txt
         
    - name: Send mail
      if: success()
      uses: dawidd6/action-send-mail@v2
      with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }} and out
          body: ${{ github.job }} job in worflow ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }} and ${{ steps.build.outputs.build }}
          to: prudhvi.reddy@betaque.com
          from: nayan
          attachments: test.txt
      
    
